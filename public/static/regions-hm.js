$(document).ready(function(){(function(){var pathname=window.location.pathname;var dd=!1;var navbar=$('#navbar');navbar.find('a.dropdown-item').each(function(i,el){if($(el).attr("href")===pathname){$(el).addClass('active');$(el).closest('li.nav-item').addClass('active');dd=!0;return!1}});if(dd===!0)return;navbar.find('li.nav-item').each(function(i,el){var a=$(el).find('a:first');if(a.attr("href")===pathname){$(el).addClass('active');return!1}})})()});function getData(k){var data=JSON.parse(sessionStorage.getItem('data'));return data[k]}
function setData(k,d){var data;if(sessionStorage.getItem('data')===null)data={};else data=JSON.parse(sessionStorage.getItem('data'));data[k]=d;sessionStorage.setItem('data',JSON.stringify(data))}
function isJson(item){item=typeof item!=="string"?JSON.stringify(item):item;try{item=JSON.parse(item)}catch(e){return!1}
if(typeof item==="object"&&item!==null){return!0}
return!1}
function getAJAX(model,logic,toScript,fromAjax,timeout,disableOverlay){var timerStart=Date.now();if(!disableOverlay)$('#overlay').show();return $.ajax({url:'routerAjax.php',type:'POST',data:{model:model,logic:logic,toScript:toScript,fromAjax:fromAjax},dataType:'html',cache:!1,timeout:timeout}).fail(function(res){console.log(res);console.log('AJAX Error')}).always(function(res){if(!disableOverlay)$('#overlay').hide();console.log('AJAX Time: '+(Date.now()-timerStart))})}
function getColorArray(){return['#4572A7','#AA4643','#0ba828','#80699B','#3D96AE','#DB843D','#92A8CD','#A47D7C','#B5CA92',"#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]}
function getDataTablesOptions(){var o={iDisplayLength:15,dom:"<'row'<'col-sm-12 col-md-6'B><'col-sm-12 col-md-6'f>>"+"<'row'<'col-sm-12 px-0'tr>>"+"<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",buttons:['copy','csv','excel',],language:{search:"Search a lag value:",info:"_START_ - _END_ (_TOTAL_ total rows)"},columnDefs:[{}],order:[0,"asc"],pagingType:"full_numbers"};return o}
function getHighChartsOptions(){var o={chart:{style:{fontFamily:'inherit'},},title:{style:{fontFamily:'inherit'}}};return o}
function arrayColumn(array,columnName){return array.map(function(value,index){return value[columnName]})}
function getCorrName(corr_type){if(corr_type==='rho')return"Pearson's Correlation Coefficient";else if(corr_type==='ktau')return"Kendall's &#120591; Coefficient";else if(corr_type==='mic')return"Maximal Information Coefficient";else if(corr_type==='srho')return"Spearman's Rho"}
function getCorrMath(corr_type){if(corr_type==='rho')return"Pearson's Correlation Coefficient";else if(corr_type==='ktau')return" \\tau = \\frac{2}{n(n-1)} \\sum_{i=1}^{N} \\sum_{j=i}^{N} \\begin{cases} 1, & \\text{if } (x_i > x_j \\text{ and } y_j > y_j)  \\text{ or } (x_i < x_j \\text{ and } y_j < y_j)  \\\\0, &\\text{if } x_i = x_j \\text{ or } y_i = y_j  \\\\-1, &\\text{otherwise} \\end{cases}";else if(corr_type==='mic')return"Maximal Information Coefficient";else if(corr_type==='srho')return"Spearman's Rho"};function buildGraph(accountsOrdered){console.log('building graph...',accountsOrdered);const d1=$.Deferred(function(dfd){const ajaxTransactionsGetAll=getAJAX(['transactionsGetAll'],[],['transactionsGetAll'],{},10000,1);ajaxTransactionsGetAll.done(function(res){let transactions=JSON.parse(res).transactionsGetAll;let dates=[...new Set(transactions.map(x=>x.date))];console.log('dates',dates);for(i=0;i<transactions.length;i++){transactions[i].credit=parseInt(transactions[i].credit);transactions[i].debit=parseInt(transactions[i].debit);transactions[i].id=parseInt(transactions[i].id);transactions[i].value=parseFloat(transactions[i].value)}
console.log('transactions',transactions);let chartData=[];for(d=0;d<dates.length;d++){date=dates[d];chartData[d]=[];for(a=0;a<accountsOrdered.length;a++){account=accountsOrdered[a];let total_debit=0;let total_credit=0;for(j=0;j<transactions.length;j++){if(new Date(transactions[j].date)>new Date(date))continue;if(transactions[j].debit!==account.id&&transactions[j].credit!==account.id)continue;if(transactions[j].debit===account.id)total_debit+=transactions[j].value;if(transactions[j].credit===account.id)total_credit+=transactions[j].value}
chartData[d].push({account:account.name,date:date,total_debit:total_debit,total_credit:total_credit,has_child:account.has_child,debit_effect:account.debit_effect,nest_level:account.nest_level})}}
console.log('chartData',chartData);for(d=0;d<dates.length;d++){let accounts=chartData[d];for(let i=0;i<accounts.length;i++){let j=1;let bal=0;let total_debit=0;let total_credit=0;if(accounts[i].has_child===!1){total_debit=accounts[i].total_debit||0;total_credit=accounts[i].total_credit||0}else{while(i+j<accounts.length&&accounts[i+j].nest_level>accounts[i].nest_level){if(accounts[i+j].has_child===!1){total_debit+=accounts[i+j].total_debit||0;total_credit+=accounts[i+j].total_credit||0}
j++}}
if(accounts[i].debit_effect===!0)debit_effect=1;else debit_effect=-1;bal=total_debit*debit_effect+total_credit*-1*debit_effect;accounts[i].bal=bal}
chartData[d]=accounts}
console.log('chartData',chartData);let chartData2={};for(let i=0;i<accountsOrdered.length;i++){chartData2[accountsOrdered[i].name]=[]}
for(let d=0;d<chartData.length;d++){for(let i=0;i<chartData[d].length;i++){chartData2[chartData[d][i].account].push([new Date(chartData[d][i].date).getTime(),chartData[d][i].bal])}}
console.log('chartData2',chartData2);let tsData=[];Object.keys(chartData2).forEach(function(acctName){tsData.push({name:acctName,data:chartData2[acctName],type:'line'})});console.log('tsData',tsData);let options={chart:{marginRight:10,backgroundColor:'rgba(225, 233, 240,.6)',plotBackgroundColor:'#FFFFFF',plotBorderColor:'#C0C0C0',height:500},title:{text:'Time Series Chart'},credits:{enabled:!1},exporting:{enabled:!1},rangeSelector:{selected:4,buttonTheme:{width:60},buttons:[{type:'month',count:1,text:'1mo'},{type:'month',count:3,text:'3mo'},{type:'ytd',count:1,text:'YTD'},{type:'year',count:1,text:'1Y'},{type:'all',text:'All'}]},xAxis:{type:'datetime',dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,},yAxis:{title:{text:'',},opposite:!0,min:0},tooltip:{useHTML:!0,formatter:function(){text='';for(i=0;i<this.points.length;i++){text+='<span style="font-weight:bold;color:'+this.points[i].series.color+'">'+this.points[i].series.name+': </span>'+this.points[i].y.toLocaleString('en-US',{style:'currency',currency:'USD',})+'</br>'}
return text},shared:!0},plotOptions:{series:{showInNavigator:!0,dataGrouping:{units:[['day',[1]]]}},line:{turboThreshold:0}},series:[]};for(i=0;i<tsData.length;i++){if(!['Equity','Retirement Investments','Mid-Term Investments','Liquid Assets'].includes(tsData[i].name))continue;options.series.push(tsData[i])}
console.log(options);new Highcharts.stockChart('tsChart',options);console.log($('#tsChart').highcharts())});dfd.resolve(data);return dfd.promise()})};/var/www/budget.charlesye.me/public/../js/regions.js;/var/www/budget.charlesye.me/public/../js/heatmap.js